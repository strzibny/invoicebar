<%= content_for :sub_navigation do %>
  <ul class="nav nav-pills" style="float:right;">
    <li class="active">
      <%= link_to t('titles.invoices'), invoices_path %>
    </li>
    <li>
      <%= link_to t('titles.invoice_templates'), invoice_templates_path %>
    </li>
  </ul>
  <div class="btn-group"  style="float:left;">
    <a class="btn btn-success" href="<%= new_invoice_path %>">
      <i class="icon-pencil icon-white"></i> <%= t('links.new_invoice') %>
    </a>
    <a class="btn btn-success dropdown-toggle" data-toggle="dropdown" href="#"><span class="caret"></span></a>
    <ul class="dropdown-menu">
      <li>
        <%= link_to t('links.new_invoice_for_contact'), contacts_path %>
      </li>
      <li>
        <%= link_to t('links.new_invoice_from_template'), invoice_templates_path %></a>
      </li>
    </ul>
  </div>
  <h1>
    <%= t('titles.invoices') %>
  </h1>
<% end %>

<ul class="nav nav-tabs" style="margin-bottom:1px;border:0">
  <li<% unless @section %> class="active"<% end %>>
    <%= link_to t('navigation.all'), filter_invoices_url(params.merge(page: 1)) %>
  </li>
  <li<% if @section == :issued %> class="active"<% end %>>
    <%= link_to t('navigation.issued'), issued_invoices_url(params.merge(page: 1)) %>
  </li>
  <li<% if @section == :received %> class="active"<% end %>>
    <%= link_to t('navigation.received'), received_invoices_url(params.merge(page: 1)) %>
  </li>
</ul>

<%= render partial: 'invoice_bar/forms/filter', params: params %>

<div class="status-filter">
  <span class="<% unless params[:status] == nil %>not-selected<% end %>">
  <%= link_to t('buttons.all'), filter_invoices_url(params.merge(status: nil)), class: 'btn-small btn-inverse btn-no-link' %>
  </span>
  <span class="<% unless params[:status] == 'not_paid' %>not-selected<% end %>">
  <%= link_to t('buttons.not_paid'), filter_invoices_url(params.merge(status: 'not_paid')), class: 'btn-small btn-danger btn-no-link' %>
  </span>
  <span class="<% unless params[:status] == 'paid' %>not-selected<% end %>">
  <%= link_to t('buttons.paid'), filter_invoices_url(params.merge(status: 'paid')), class: 'btn-small btn-success btn-no-link' %>
  </span>
  <span class="<% unless params[:status] == 'not_sent' %>not-selected<% end %>">
  <%= link_to t('buttons.not_sent'), filter_invoices_url(params.merge(status: 'not_sent')), class: 'btn-small btn-warning btn-no-link' %>
  </span>
  <span class="<% unless params[:status] == 'sent' %>not-selected<% end %>">
  <%= link_to t('buttons.sent'), filter_invoices_url(params.merge(status: 'sent')), class: 'btn-small btn-info btn-no-link' %>
  </span>
</div>

<table class="table table-striped table-bordered table-hover">
  <thead>
     <tr>
      <th class="number hidden-phone">
        <%= link_to "# #{t('attributes.invoice.number')}", filter_invoices_url(params.merge(page: 1, sort: 'number')) %>
      </th>
      <th class="contact_name">
        <%= link_to t('attributes.invoice.contact_name'), filter_invoices_url(params.merge(page: 1, sort: 'contact_name')) %>
      </th>
       <th class="issue_date hidden-phone">
        <%= link_to t('attributes.invoice.issue_date'), filter_invoices_url(params.merge(page: 1, sort: 'issue_date')) %>
      </th>
      <th class="due_date hidden-phone">
        <%= link_to t('attributes.invoice.due_date'), filter_invoices_url(params.merge(page: 1, sort: 'due_date')) %>
      </th>
      <th class="amount">
        <%= link_to t('attributes.invoice.amount'), filter_invoices_url(params.merge(page: 1, sort: 'amount')) %>
      </th>
      <th>
        <%= t('attributes.invoice_bar.invoice.status') %>
      </th>
    </tr>
  </thead>
  <tbody>
    <% @invoices.each do |invoice| %>
      <tr>
        <td class="number hidden-phone">
          <span><%= link_to invoice do %><%= invoice.number %><% end %></span>
        </td>
        <td class="contact_name">
          <span><%= invoice.contact_name %></span>
        </td>
        <td class="issue_date hidden-phone">
          <span><%= l(invoice.issue_date) %></span>
        </td>
        <td class="due_date hidden-phone">
          <span><%= l(invoice.due_date) %></span>
        </td>
        <td class="amount">
          <span><%= formatted_amount(invoice.amount, invoice.account.currency_symbol) %></span>
        </td>
        <td class="state">
          <% if invoice.paid %>
            <%= link_to t('buttons.paid'), invoice_path(invoice), class: 'btn-small btn-success btn-no-link' %>
          <% elsif invoice.due_date >= Date.today and invoice.issued? %>
            <% if invoice.sent? %>
              <%= link_to t('buttons.sent'), invoice_path(invoice), class: 'btn-small btn-info btn-no-link' %>
            <% else %>
              <%= link_to t('buttons.not_sent'), invoice_path(invoice), class: 'btn-small btn-warning btn-no-link' %>
            <% end %>
          <% else %>
            <%= link_to t('buttons.not_paid'), invoice_path(invoice), class: 'btn-small btn-danger btn-no-link' %>
          <% end %>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>

<% if @invoices.size == 0 %>
  <div class="no-data">
    <%= t('invoice_bar.no_data') %>
  </div>
<% end %>

<%= paginate @invoices %>
